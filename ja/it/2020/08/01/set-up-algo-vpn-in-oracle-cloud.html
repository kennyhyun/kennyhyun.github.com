<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    
    <!-- naver web master -->
    <meta name="robots" content="index,follow" />
    <meta name="NaverBot" content="All" />
    <meta name="NaverBot" content="index,follow" />
    <meta name="Yeti" content="All" />
    <meta name="Yeti" content="index,follow" />

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>無料VPS、Oracle cloud使ったAlgo VPNの紹介 | Kenny on IT</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="無料VPS、Oracle cloud使ったAlgo VPNの紹介" />
<meta name="author" content="Kenny Yeo" />
<meta property="og:locale" content="ja" />
<meta name="description" content="たまに海外のVPNサーバーがいる時がありますが、そのためにわざわざ月額払ってまで使いたくはないですよね。 最近は無料のサーバーも結構あるようです。Wireguardと一緒ならアイパッドやアイフォン、アンドロイド、パスコン、マックどこでも気楽に設定できます。 ここで皆さんもVPNサーバーが設定できるようにガイドします :)" />
<meta property="og:description" content="たまに海外のVPNサーバーがいる時がありますが、そのためにわざわざ月額払ってまで使いたくはないですよね。 最近は無料のサーバーも結構あるようです。Wireguardと一緒ならアイパッドやアイフォン、アンドロイド、パスコン、マックどこでも気楽に設定できます。 ここで皆さんもVPNサーバーが設定できるようにガイドします :)" />
<link rel="canonical" href="https://kenny.yeoyou.net/it/2020/08/01/set-up-algo-vpn-in-oracle-cloud.html" />
<meta property="og:url" content="https://kenny.yeoyou.net/it/2020/08/01/set-up-algo-vpn-in-oracle-cloud.html" />
<meta property="og:site_name" content="Kenny on IT" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-01T10:41:01+00:00" />
<script type="application/ld+json">
{"headline":"無料VPS、Oracle cloud使ったAlgo VPNの紹介","dateModified":"2020-08-01T10:41:01+00:00","datePublished":"2020-08-01T10:41:01+00:00","author":{"@type":"Person","name":"Kenny Yeo"},"url":"https://kenny.yeoyou.net/it/2020/08/01/set-up-algo-vpn-in-oracle-cloud.html","description":"たまに海外のVPNサーバーがいる時がありますが、そのためにわざわざ月額払ってまで使いたくはないですよね。 最近は無料のサーバーも結構あるようです。Wireguardと一緒ならアイパッドやアイフォン、アンドロイド、パスコン、マックどこでも気楽に設定できます。 ここで皆さんもVPNサーバーが設定できるようにガイドします :)","mainEntityOfPage":{"@type":"WebPage","@id":"https://kenny.yeoyou.net/it/2020/08/01/set-up-algo-vpn-in-oracle-cloud.html"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    
    <meta name="keywords" content="algovpn, algo, wireguard, vpn, iphone, ipad, android, アイフォン, アイパッド, oracle, oracle-cloud"/>
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css " />
    
    <meta name="naver-site-verification" content="c2e81e9ed92ee39337612e88df3828e3e21fc8b9" />

</head>
<body class="home-template">

    <header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="back-button icon-arrow-left" href="/">Home</a>

        <section class="language">
    
    
    
    
        <a class="back-button lang-ko" href="/ko/it/2020/08/01/set-up-algo-vpn-in-oracle-cloud.html">한국어</a>
    
    
    
        <a class="back-button lang-en" href="/it/2020/08/01/set-up-algo-vpn-in-oracle-cloud.html">English</a>
    
</section>


        <a class="subscribe-button icon-feed" href="/ja/feed.xml">Subscribe</a>
    </nav>
</header>

<main class="content" role="main">

    <article class="post">

        <header class="post-header">
            <h1 class="post-title">無料VPS、Oracle cloud使ったAlgo VPNの紹介</h1>
            <section class="post-meta">
                
                    on IT
                
                <time class="post-date" datetime="2020-08-01">01 Aug 2020</time>
            </section>
        </header>

<!--         <header class="post-header">
            <a id="blog-logo" href="https://kenny.yeoyou.net">
                
                    <span class="blog-title">Kenny on IT</span>
                
            </a>
        </header> -->

        <!-- <span class="post-meta">
            <time datetime="2020-08-01">01 Aug 2020</time>
            
                on IT
            
        </span> -->

        <!-- <h1 class="post-title">無料VPS、Oracle cloud使ったAlgo VPNの紹介</h1> -->

        <section class="post-content">
            <p>たまに海外のVPNサーバーがいる時がありますが、そのためにわざわざ月額払ってまで使いたくはないですよね。</p>

<p>しかし、既に仮想サーバーが海外に既にある場合はどうでしょうか？最近は無料のサーバーも結構あるようです。</p>

<p>CloudにAlgo VPNサーバーをインストールしてみました。</p>

<p>皆さんにこの情報が役立てればと思います。</p>

<h3 id="免責">免責</h3>

<p>VPNを使用に関しては各自の責任で御使用願います。私はOracle CloudやVPNの使用について一切の責任を負いません。</p>

<h3 id="インスタンス生成">インスタンス生成</h3>

<ol>
  <li>ここ<a href="https://www.oracle.com/au/cloud/free/" target="_blank">Oracle Cloud</a>でアカウントを作成します
    <ul>
      <li>ホームリージョンは、VPNを使用したい場所に設定します</li>
    </ul>
  </li>
  <li>Webコンソールにアクセスして「Create a VM instance」ボタンをクリックします
  <img src="/assets/images/2020/vpn/instance1.jpg" alt="Insttance1" />
    <ul>
      <li>Ubuntu minimalを選んでpublic keyをアップロードします
        <ul>
          <li>sshキーがない場合は、次を参考に作成しますhow to create ssh key</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>「create」をクリックすると、次のように詳細を確認することができます
  <img src="/assets/images/2020/vpn/instance2.jpg" alt="Insttance2" width="80%" />
    <ul>
      <li>公認のIPアドレスをメモっておきます</li>
    </ul>
  </li>
</ol>

<p>さて、生成が完了するとssh経由でインスタンスに接続できます。</p>

<h3 id="algo-vpnのインストール">Algo VPNのインストール</h3>

<p>上記の生成したインスタンスに接続して、次のようにVPNサーバーをインストールします。</p>

<h4 id="aptパッケージのインストール">Aptパッケージのインストール</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt upgrade <span class="nt">-y</span>
<span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> python3-virtualenv unzip vim
</code></pre></div></div>
<p>希望のエディタも忘れずに追加します。vimが慣れてない方は代わりnanoを使用しましょう。</p>

<h4 id="algoのダウンロード">Algoのダウンロード</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>wget https://github.com/trailofbits/algo/archive/master.zip
<span class="nv">$ </span>unzip master.zip
</code></pre></div></div>

<h4 id="virtualenvの設定">virtualenvの設定</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>algo-master
<span class="nv">$ </span>python3 <span class="nt">-m</span> virtualenv <span class="nt">--python</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">command</span> <span class="nt">-v</span> python3<span class="si">)</span><span class="s2">"</span> .env <span class="o">&amp;&amp;</span>
  <span class="nb">source</span> .env/bin/activate <span class="o">&amp;&amp;</span>
  python3 <span class="nt">-m</span> pip <span class="nb">install</span> <span class="nt">-U</span> pip virtualenv <span class="o">&amp;&amp;</span>
  python3 <span class="nt">-m</span> pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
</code></pre></div></div>

<h4 id="ユーザーの追加">ユーザーの追加</h4>

<p><code class="language-plaintext highlighter-rouge">config.cfg</code>を編集して、ユーザーを追加します。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vi config.cfg
</code></pre></div></div>

<p>ユーザーを共有すると時々問題があるそうなので、次のように十分に追加しておくことをお勧めします。</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">users</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">phone</span>
  <span class="pi">-</span> <span class="s">phone2</span>
  <span class="pi">-</span> <span class="s">tablet</span>
  <span class="pi">-</span> <span class="s">tablet2</span>
  <span class="pi">-</span> <span class="s">laptop</span>
  <span class="pi">-</span> <span class="s">laptop2</span>
  <span class="pi">-</span> <span class="s">desktop</span>
  <span class="pi">-</span> <span class="s">desktop2</span>
  <span class="pi">-</span> <span class="s">server</span>
  <span class="pi">-</span> <span class="s">server2</span>
  <span class="pi">-</span> <span class="s">guest</span>
  <span class="pi">-</span> <span class="s">guest2</span>
</code></pre></div></div>

<h4 id="配布スクリプトの実行">配布スクリプトの実行</h4>

<p>次は対話型のスクリプトです。いくつかの選択肢に答えると、スクリプトがインストールを行います。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./algo
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Cloud prompt]
What provider would you like to use?
<span class="nt">--</span><span class="o">&gt;</span> 11. Install to existing Ubuntu 18.04 or 20.04 server <span class="o">(</span><span class="k">for </span>more advanced <span class="nb">users</span><span class="o">)</span>
</code></pre></div></div>

<p>最初の質問が最も重要です。現在接続したサーバーにインストールするので11番を選択します。</p>

<p>残りのほとんどはデフォルトの設定でエンターを押すだけで良いですが、次の２つの質問に違う答えを入れましょう。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Retain the PKI prompt]
Do you want to retain the keys <span class="o">(</span>PKI<span class="o">)</span>? <span class="o">(</span>required to add <span class="nb">users </span><span class="k">in </span>the future, but less secure<span class="o">)</span>
<span class="o">[</span>y/N]
<span class="nt">--</span><span class="o">&gt;</span> Y
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span><span class="nb">local</span> : pause]
Enter the public IP address or domain name of your server: <span class="o">(</span>IMPORTANT! This is used to verify the certificate<span class="o">)</span>
<span class="o">[</span>localhost]
<span class="nt">---</span><span class="o">&gt;</span> <span class="o">[</span>Put the public IP adress of your instance]
</code></pre></div></div>

<p>これにより、次のように出力され、インストールが終了します。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">'#                       Congratulations!                         #'</span>
<span class="s">'#                  Your Algo server is running.                  #'</span>
<span class="s">'# Config files and certificates are in the ./configs/ directory. #'</span>
<span class="s">'#           Go to https://whoer.net/ after connecting            #'</span>
<span class="s">'#     and ensure that all your traffic passes through the VPN.   #'</span>
<span class="s">'#                  Local DNS resolver 172.29.**.**               #'</span>
<span class="s">'#     The p12 and SSH keys password for new users is *********   #'</span>
<span class="s">'#     The CA key password is ****************                    #'</span>
</code></pre></div></div>

<p>何かが間違ったら、最初から再インストールすることが良いと言われます。現在のインスタンスを破棄し、新しいインスタンスを再作成します。</p>

<h4 id="接続情報のコピー">接続情報のコピー</h4>

<p>次はVPNサーバーのssh接続は終了してもいいです。</p>

<p>今使用しているローカル環境でscpコマンドで接続情報をコピーします。次の「vpnserver」はVPNサーバーのパブリックIPに置き換えます。</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>scp <span class="nt">-r</span> ubuntu@vpnserver:algo-master/configs <span class="nb">.</span>
</code></pre></div></div>

<p>それでは「configs」ディレクトリにある接続情報が使えます。</p>

<h3 id="vpnサーバーのポートの開放">VPNサーバーのポートの開放</h3>

<p>VPNサーバー自体は用意できてますが、あとひとステップが残っています。</p>

<p>VPN接続に必要な<a href="https://github.com/trailofbits/algo/blob/master/docs/firewalls.md" target="_blank">ポート</a>は、通常閉じてあるので、手動で開けなければなりません。</p>

<h4 id="vpn接続に使用するsecurity-listの作成">VPN接続に使用するSecurity Listの作成</h4>

<p>Oracle Cloudのウェブコンソールに接続します。</p>

<ol>
  <li>Networking &gt; Virtual Cloud Networksを開きます</li>
  <li>右のVCN nameをクリックします</li>
  <li>左の「Security Lists」をクリックします</li>
  <li>「Create Security List」をクリックします</li>
  <li>ポップアップには、次のように入力します
    <ul>
      <li>Name: VPN</li>
      <li>Additional Ingress Rule: Ingress Rule 1
        <ul>
          <li>Source CIDR: 0.0.0.0/0</li>
          <li>Destination Port Range: 4160</li>
        </ul>
      </li>
      <li>Additional Ingress Rule: Ingress Rule 2
        <ul>
          <li>Source CIDR: 0.0.0.0/0</li>
          <li>IP Protocol: UDP</li>
          <li>Destination Port Range: 51820,500,4500</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Create Security List</code>をクリックして確定します</li>
</ol>

<p><img src="/assets/images/2020/vpn/vpn.ports.jpg" alt="vpn ports" /></p>

<h4 id="security-listをpublic-subnetに繋ぐ">Security ListをPublic Subnetに繋ぐ</h4>

<ol>
  <li>Instace Details (Compute &gt; Instaces &gt; Instance Details)を開きます</li>
  <li>Primary VNICのSubnetをクリックします</li>
  <li>「Add Security List」をクリックします</li>
  <li>ポップアップのsecurity listプルダウンのVPNを選択します</li>
  <li>「Add Security List」をクリックして確定します</li>
</ol>

<h3 id="clientの設定">Clientの設定</h3>

<p>取りあえずアイパッドにての設定法について説明します。</p>

<ol>
  <li>AppstoreでWireGuardをインストールします（iOS 12以降が必要です）</li>
  <li><code class="language-plaintext highlighter-rouge">configs/localhost/wireguard/tablet.png</code>のようにユーザーに合ったPNGのQRコードを開きます
  「configs」ディレクトリは、前の手順でコピーしておいたものです</li>
  <li>WireGuardを実行し、「+」ボタンをタッチして「Create from QR code」を選択します</li>
  <li>QR code撮ってtabletのように名前を付けときます</li>
  <li>その生成されたtabletの接続をオンにします</li>
</ol>

<p>これでVPNに接続されます。</p>

<p>ブラウザを開いて「my ip」を検索するとVPN serverのアドレスが表示されるか確認します。</p>

<p>WireGuardアプリはMac and Windows 10にても使用可能なので、似たような方法で設定でます。</p>

<h3 id="トラブルシューティング">トラブルシューティング</h3>

<p>サーバーに接続することができなくてもWireGuardアプリは黙ってインターネットが不通になります。
インターネット接続に問題がある場合VPN接続を終了し、サーバーの問題を解決した後、もう一度お試しください。</p>

<h3 id="もっと読む">もっと読む</h3>

<ul>
  <li><a href="https://github.com/trailofbits/algo#deploy-the-algo-server" target="_blank">Algo VPN</a></li>
</ul>


        </section>

        

        <footer class="post-footer">
            <!-- If we want to display author's name and bio -->
            
                <figure class="author-image">
                    <a class="img" href="/" style="background-image: url(/assets/images/profile.png)">
                    <span class="hidden">Kenny Yeo's Picture</span></a>
                </figure>
                <section class="author">
                    <!-- Author Name -->
                    <h4> Kenny Yeo </h4>
                    <!-- Author Bio -->
                    <p>
                      A NodeJS Fullstack SW Engineer at Whitech Software Solution(a Fujifilm group company)<br />
                      <a href="https://github.com/kennyhyun" target="_blank">Github</a> | <a href="https://www.linkedin.com/in/khyunyeo/">Linkedin</a>
                    </p>
                </section>
            

            <!-- Share links section -->
            <section class="share">
    <h4>Share this post</h4>
    <a class="icon-twitter" href="http://twitter.com/share?text=無料VPS、Oracle cloud使ったAlgo VPNの紹介&amp;url=https://kenny.yeoyou.net/it/2020/08/01/set-up-algo-vpn-in-oracle-cloud.html"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://kenny.yeoyou.net/it/2020/08/01/set-up-algo-vpn-in-oracle-cloud.html"
        onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=https://kenny.yeoyou.net/it/2020/08/01/set-up-algo-vpn-in-oracle-cloud.html"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>

            <!-- Disqus comments -->
            
                <section class="disqus">
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
     this.page.url = "https://kenny.yeoyou.net/it/2020/08/01/set-up-algo-vpn-in-oracle-cloud.html";
     this.page.identifier = "/it/2020/08/01/set-up-algo-vpn-in-oracle-cloud.html";
    };

    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://kennyyeoyounet.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
</section>

            

        </footer>

    </article>

</main>

    <footer class="site-footer clearfix">
      <section class="copyright">
        <a href="/ja">Kenny on IT</a> &copy; 
              2020 &bull; All rights reserved.
      </section>
      <section class="poweredby">Made with Jekyll using 
        <a href="http://github.com/rosario/kasper">Kasper theme</a>
      </section>
    </footer>
    
    <script type="text/javascript" src="/assets/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-xxxxxxxx"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-xxxxxxxx');
    </script>
</body>
</html>
